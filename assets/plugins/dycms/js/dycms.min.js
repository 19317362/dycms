/*! Copyright (c) 2018 Abu Dzakiyyah (https://abu.dzakiyyah.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 *
 * Version: 1.2
 *
 */
$(document).ajaxStart(function(){Pace.restart()});contentAutoHeight({element:".mainContent",scroll:true,drag:false,substract:170,plugin:"slimScroll"});function contentAutoHeight(h){var d=h.element;var a=h.scroll;var e=h.drag;var b=h.substract;var g=h.plugin;var c="";var f=$(document).height()-b;if(g==="niceScroll"){$(d).attr("style","height:"+f+"px;");if(e===true){c={touchbehavior:true,usetransition:true,hwacceleration:true}}else{c=""}if(a===true){$(d).niceScroll(c)}}else{if(g==="slimScroll"){$(d).slimScroll({height:f,size:"3px"})}else{console.log("No Plugin")}}}function getNext(){var a=$(".mainNav>ul>li.active").next();a.find("a").click()}function getPrev(){var a=$(".mainNav>ul>li.active").prev();a.find("a").click()}function initCloseTab(){$("span.closeTab").click(function(){var c=$(this).parents("li a"),e=c[0].hash,a=e.split("#"),d=$(this).parents("li.active").prev(),b=$(this).parents("li.active").next();$(this).parents("li").remove();$(e).remove();deleteData({key:"mainTabs",param:"tabId",find:a[1]});if(b.length===0){d.find("a").click()}else{b.find("a").click()}})}function loadURL(a,b,c){$.get(a,c,function(d){$(b).html(d)}).fail(function(){var d='<div class="error-page"><h2 class="headline text-yellow" style="margin-top: -25px; margin-bottom: 0;"> 404</h2><div class="error-content"><h3><i class="fa fa-warning text-yellow"></i> Oops! Terjadi Kesalahan...</h3><p>Sistem tidak dapat menemukan halaman yang anda akses, silahkan menghubungi Administrator untuk masalah ini.</p></div></div>';$(b).html(d)})}function restoreSettings(){var b=getData({key:"mainTabs"}),a=getData({key:"appSettings"});if(b!==null){restoreTabs(b)}else{pushData({key:"mainTabs",data:[{tabIndex:0,tabId:"home",tabUrl:"pages/home.html",tabTitle:"Beranda",tabIcon:"fa fa-home",tabDesc:"Selamat Datang Admin",tabStatus:"active"}]});tabTrigger("a[href='#home']");$("a[href='#home']").tab("show");loadURL("pages/home.html","#homeContent")}if(a!==null){if(a[0].sidebar==="sidebar-collapse"){$("body").addClass(a[0].sidebar)}else{$("body").removeClass(a[0].sidebar)}if(a[0].skin!==null){$("body").addClass(a[0].skin)}}}function restoreTabs(e){var d=$(".mainNav ul.nav"),f=$(".mainNav div.tab-content"),h="",c="",b="",g="",a="";$.each(e,function(j,k){if(k.tabId!=="home"){var i=$(".subMenu[data-id='"+k.tabId+"']"),l=i.parents("li.treeview").find("span").html(),m=i.parents("li.treeview").find("i").attr("class");h='<li data-index="'+k.tabIndex+'"><a href="#'+k.tabId+'" data-toggle="tab" title="'+k.tabDesc+'"><i class="'+k.tabIcon+'"></i> '+k.tabTitle+' <span class="closeTab" title="Close Tab"><i class="fa fa-times"></i></span></a></li>';c='<div class="tab-pane" id="'+k.tabId+'"><section class="content-header"><h1>'+l+"<small>"+k.tabDesc+'</small></h1><ol class="breadcrumb"><li><a><i class="'+m+'"></i> '+l+'</a></li><li class="active">'+k.tabTitle+'</li></ol></section><section id="'+k.tabId+'Content" class="content text-justify mainContent"></section></div>'}d.append(h);f.append(c);if(k.tabStatus==="active"){b=k.tabId;g=k.tabUrl}else{a='<div class="error-page"><div class="error-content text-center" style="margin-left: 0;"><h3><i class="fa fa-info-circle text-primary"></i> Mode penghemat daya aktif...</h3><p>Anda telah merefresh browser, Silahkan tekan tombol reload untuk memuat halaman<br><br><button class="btn btn-primary" onclick="restoreContent(\''+k.tabId+"','"+k.tabUrl+'\');" data-toggle="tooltip" title="Tekan untuk reload halaman" data-container=".tab-content" ><i class="fa fa-spinner fa-spin"></i> Reload</button></p></div></div>';$("#"+k.tabId+"Content.mainContent").append(a)}tabTrigger("a[href='#"+k.tabId+"']");contentAutoHeight({element:"#"+k.tabId+"Content",scroll:true,drag:false,substract:170,plugin:"slimScroll"})});initCloseTab();initDynamicTab();$("a[href='#"+b+"']").tab("show");loadURL(g,"#"+b+"Content")}function restoreContent(b,a){contentAutoHeight({element:"#"+b+"Content",scroll:true,drag:false,substract:170,plugin:"slimScroll"});loadURL(a,"#"+b+"Content")}function buildTabs(a){var f=$(".mainNav>ul.nav"),h=$(".mainNav>div.tab-content"),j=$(a.parent[0]).find("i").attr("class"),d=$(a.parent[0]).find("span").html(),b=f.find("a[href='#"+a.id+"']"),e=f.find("li:last-child").attr("data-index"),i=parseInt(e)+1,g='<li data-index="'+i+'"><a href="#'+a.id+'" data-toggle="tab" title="'+a.desc+'"><i class="'+a.icon+'"></i> '+a.title+' <span class="closeTab" title="Close Tab"><i class="fa fa-times"></i></span></a></li>',c='<div class="tab-pane" id="'+a.id+'"></div>';navContentHeader='<section class="content-header"><h1>'+d+"<small>"+a.desc+'</small></h1><ol class="breadcrumb"><li><a><i class="'+j+'"></i> '+d+'</a></li><li class="active">'+a.title+'</li></ol></section><section id="'+a.id+'Content" class="content text-justify mainContent"></section>';if(b.length<1){f.append(g);h.append(c);$("#"+a.id).append(navContentHeader);pushData({key:"mainTabs",data:[{tabIndex:i,tabId:a.id,tabUrl:a.url,tabTitle:a.title,tabIcon:a.icon,tabDesc:a.desc,tabStatus:""}]});initCloseTab();contentAutoHeight({element:"#"+a.id+"Content",scroll:true,drag:false,substract:170,plugin:"slimScroll"});loadURL(a.url,"#"+a.id+"Content");initDynamicTab();tabTrigger("a[href='#"+a.id+"']");return true}else{initDynamicTab();return false}}function tabTrigger(a){$(a).on("shown.bs.tab",function(){var b=parseInt($(this).parent("li").attr("data-index"));changeData({key:"mainTabs",findParam:"tabIndex",setParam:"tabStatus",find:b,setValue:"active:"})})}function initMenuClick(){$(".tb-skin td").click(function(){var a=$(this).find("img").attr("alt"),b=getData({key:"appSettings"});$("body").removeClass(b[0].skin).addClass(a);updateData({key:"appSettings",setParam:"skin",replace:true,setValue:a})});$(".sidebar-toggle").click(function(){var a=getData({key:"appSettings"});if($("body").delay(300).hasClass("sidebar-collapse")){if(a!==null){updateData({key:"appSettings",findParam:"sidebar",setParam:"sidebar",find:"sidebar-collapse",setValue:""})}else{pushData({key:"appSettings",data:[{sidebar:"",skin:"skin-blue"}]})}}else{if(a!==null){updateData({key:"appSettings",findParam:"sidebar",setParam:"sidebar",find:"",setValue:"sidebar-collapse"})}else{pushData({key:"appSettings",data:[{sidebar:"sidebar-collapse",skin:"skin-blue"}]})}}});$(".dropdown-menu li>.menu").slimScroll({height:"200px",size:"3px"});$(".subMenu").click(function(){var b={url:$(this).data("url"),id:$(this).data("id"),desc:$(this).data("desc"),parent:$(this).parents("li.treeview").find("a"),icon:$(this).find("i").attr("class"),title:$(this).find("span").html()};var d=buildTabs(b);var c=$('.mainNav>ul>li>a[href="#'+b.id+'"]'),a=parseInt(c.parent("li").attr("data-index"));c.tab("show");if(d===false){changeData({key:"mainTabs",findParam:"tabIndex",setParam:"tabStatus",find:a,setValue:"active:"})}})}function buildMenu(c){var e=c.menu,d=$("ul.sidebar-menu"),b="",a="";$.each(e,function(g,f){if(f.mainMenuChild===true){b+='<li class="treeview"><a><i class="'+f.mainMenuIcon+'"></i> <span>'+f.mainMenuTitle+'</span><span class="pull-right-container"><i class="fa fa-angle-left pull-right"></i></span></a>';a='<ul class="treeview-menu">';$.each(f.mainMenuContent,function(i,h){a+='<li><a class="subMenu" data-url="'+h.subMenuUrl+'" data-id="'+h.subMenuId+'" data-desc="'+h.subMenuDesc+'"><i class="'+h.subMenuIcon+'"></i> <span>'+h.subMenuTitle+"</span></a></li>"});a+="</ul>"}else{b+='<li class="treeview"><a class="subMenu" data-url="'+f.mainMenuUrl+'" data-id="'+f.mainMenuId+'" data-desc="'+f.mainMenuDesc+'"><i class="'+f.mainMenuIcon+'"></i> <span>'+f.mainMenuTitle+"</span></a>"}b+=a+"</li>"});d.append(b)}function buildAppInfo(){var q=$.ajax({url:"app.json",type:"get",async:false,success:function(s){return s}}),g=q.responseJSON[0].AppName,d=q.responseJSON[0].AppDesc,e=q.responseJSON[0].AppVersion,n=q.responseJSON[0].AppLink,i=q.responseJSON[0].AppLogo,k=q.responseJSON[0].AppWebsite,j=q.responseJSON[0].AppAuthor,r=q.responseJSON[0].AuthorWebsite,o=q.responseJSON[0].DataContent[0].moduleData;var m=getData({key:"appInfo"}),a=getData({key:"moduleMenu"}),f=getData({key:"appSettings"}),p=$("body>.wrapper>.main-header>a"),h=$("body>.wrapper>.main-header>a>span.logo-lg"),l=$("body>.wrapper>.main-header>a>span.logo-mini"),b=$("footer.main-footer>div>span.version"),c=$("footer.main-footer>span.copyright>a");if(m===null){pushData({key:"appInfo",data:[{AppName:g,AppDesc:d,AppVersion:e,AppLink:n,AppLogo:i,AppWebsite:k,AppAuthor:j,AuthorWebsite:r}]});document.title=g+" | "+d;p.attr("href",n);h.html(g);l.html("<i class='fa fa-shopping-bag'></img>");b.html(e);c.html(j);c.attr("href",r)}else{document.title=m[0].AppName+" | "+m[0].AppDesc;p.attr("href",m[0].AppLink);h.html(m[0].AppName);l.html("<i class='fa fa-shopping-bag'></img>");b.html(m[0].AppVersion);c.html(m[0].AppAuthor);c.attr("href",m[0].AuthorWebsite)}if(a===null){buildMenu({menu:o});pushData({key:"moduleMenu",data:o});pushData({key:"mainTabs",replace:true,data:[{tabIndex:0,tabId:"home",tabUrl:"pages/home.html",tabTitle:"Beranda",tabIcon:"fa fa-home",tabDesc:"Selamat Datang Admin",tabStatus:"active"}]});restoreSettings();initMenuClick()}else{if(JSON.stringify(o)!==JSON.stringify(a)){jConfirm("Terjadi perubahan struktur menu, Anda yakin akan <br> memuat konfigurasi menu yang baru?",g+" v. "+e,function(s){if(s){buildMenu({menu:o});pushData({key:"moduleMenu",data:o,replace:true});pushData({key:"mainTabs",replace:true,data:[{tabIndex:0,tabId:"home",tabUrl:"pages/home.html",tabTitle:"Beranda",tabIcon:"fa fa-home",tabDesc:"Selamat Datang Admin",tabStatus:"active"}]});restoreSettings();initMenuClick()}else{buildMenu({menu:a});restoreSettings();initMenuClick()}})}else{buildMenu({menu:a});restoreSettings();initMenuClick()}}if(f===null){pushData({key:"appSettings",data:[{sidebar:"",skin:"skin-blue"}]});$("body").addClass("skin-blue")}}$(function(){buildAppInfo()});